(function(e){e.fn.shorten=function(t){"use strict";var n={showChars:100,ellipsesText:"...",moreText:"more",lessText:"less",errMsg:null};if(t){e.extend(n,t)}e(document).off("click",".morelink");e(document).on({click:function(){var t=e(this);if(t.hasClass("less")){t.removeClass("less");t.html(n.moreText);t.parent().prev().prev().show();t.parent().prev().hide()}else{t.addClass("less");t.html(n.lessText);t.parent().prev().prev().hide();t.parent().prev().show()}return false}},".morelink");return this.each(function(){var t=e(this);var r=t.html();var i=t.text().length;if(i>n.showChars){var s=r.substr(0,n.showChars);if(s.indexOf("<")>=0){var o=false;var u="";var a=0;var f=[];var l=null;for(var c=0,h=0;h<=n.showChars;c++){if(r[c]=="<"&&!o){o=true;l=r.substring(c+1,r.indexOf(">",c));if(l[0]=="/"){if(l!="/"+f[0]){n.errMsg="ERROR en HTML: the top of the stack should be the tag that closes"}else{f.shift()}}else{if(l.toLowerCase()!="br"){f.unshift(l)}}}if(o&&r[c]==">"){o=false}if(o){u+=r.charAt(c)}else{h++;if(a<=n.showChars){u+=r.charAt(c);a++}else{if(f.length>0){for(j=0;j<f.length;j++){u+="</"+f[j]+">"}break}}}}s=u}var p='<span class="shortcontent">'+s+" "+n.ellipsesText+'</span><span class="allcontent">'+r+'</span>  <span><a href="javascript://nop/" class="morelink">'+n.moreText+"</a></span>";t.html(p);e(".allcontent").hide()}})}})(jQuery)